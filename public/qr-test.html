<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ äºŒç»´ç åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            border-left: 4px solid #8B5CF6;
        }
        .qr-demo-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        .qr-demo {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            min-width: 280px;
            flex: 1;
        }
        .qr-canvas {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            margin: 15px 0;
        }
        button {
            background: #8B5CF6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin: 8px 5px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        button:hover { 
            background: #7C3AED; 
            transform: translateY(-2px);
        }
        .success { 
            color: #4CAF50; 
            background: rgba(76, 175, 80, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .error { 
            color: #f44336;
            background: rgba(244, 67, 54, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .info { 
            color: #2196F3;
            background: rgba(33, 150, 243, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        #console-output {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .url-input {
            width: 100%;
            padding: 10px;
            border: 2px solid rgba(139, 92, 246, 0.5);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            margin: 10px 0;
            font-size: 1rem;
        }
        .url-input::placeholder {
            color: rgba(255,255,255,0.7);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #8B5CF6;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ äºŒç»´ç åŠŸèƒ½æµ‹è¯•å·¥å…·</h1>
    <p>æµ‹è¯•å„ç§äºŒç»´ç ç”Ÿæˆåœºæ™¯ï¼ŒéªŒè¯å¯é æ€§</p>
    
    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»Ÿè®¡</h2>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-tests">0</div>
                <div class="stat-label">æ€»æµ‹è¯•æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="success-count">0</div>
                <div class="stat-label">æˆåŠŸæ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="fail-count">0</div>
                <div class="stat-label">å¤±è´¥æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="success-rate">0%</div>
                <div class="stat-label">æˆåŠŸç‡</div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª å¿«é€Ÿæµ‹è¯•</h2>
        <button onclick="runQuickTest()">âš¡ å¿«é€Ÿæµ‹è¯•</button>
        <button onclick="runStressTest()">ğŸƒ å‹åŠ›æµ‹è¯• (5æ¬¡)</button>
        <button onclick="runAllTests()">ğŸ”„ å…¨é¢æµ‹è¯•</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ¯ è‡ªå®šä¹‰æµ‹è¯•</h2>
        <input type="text" 
               class="url-input" 
               id="custom-url" 
               placeholder="è¾“å…¥è¦æµ‹è¯•çš„URL (å¦‚: https://example.com/view.html?id=test)"
               value="">
        <br>
        <button onclick="testCustomUrl()">ğŸ“² ç”Ÿæˆè‡ªå®šä¹‰äºŒç»´ç </button>
        <button onclick="testLongUrl()">ğŸ“ æµ‹è¯•é•¿URL</button>
        <button onclick="testSpecialChars()">ğŸ”£ æµ‹è¯•ç‰¹æ®Šå­—ç¬¦</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“± ç”Ÿæˆç»“æœ</h2>
        <div class="qr-demo-container" id="qr-container">
            <!-- äºŒç»´ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“ æ§åˆ¶å°æ—¥å¿—</h2>
        <div id="console-output"></div>
        <button onclick="clearConsole()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div style="text-align: center; margin: 30px 0;">
        <button onclick="location.href='index.html'">ğŸ  è¿”å›ä¸»åº”ç”¨</button>
        <button onclick="location.href='fix-test.html'">ğŸ”§ ç»¼åˆæµ‹è¯•</button>
    </div>

    <script src="qrcode-simple.js?v=1.3"></script>
    <script>
        let testStats = {
            total: 0,
            success: 0,
            fail: 0
        };

        // åŠ«æŒconsole.logä»¥æ˜¾ç¤ºæ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsole(message, type = 'log') {
            const output = document.getElementById('console-output');
            const time = new Date().toLocaleTimeString();
            const colors = {
                log: '#ffffff',
                error: '#ff6b6b',
                warn: '#ffd93d',
                success: '#51cf66'
            };
            
            output.innerHTML += `<div style="color: ${colors[type] || colors.log}">
                [${time}] ${message}
            </div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };

        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('success-count').textContent = testStats.success;
            document.getElementById('fail-count').textContent = testStats.fail;
            
            const rate = testStats.total > 0 ? Math.round((testStats.success / testStats.total) * 100) : 0;
            document.getElementById('success-rate').textContent = rate + '%';
        }

        async function generateQR(url, title = 'æµ‹è¯•äºŒç»´ç ') {
            const container = document.getElementById('qr-container');
            const qrId = 'qr-' + Date.now();
            
            // åˆ›å»ºå®¹å™¨
            const qrDiv = document.createElement('div');
            qrDiv.className = 'qr-demo';
            qrDiv.innerHTML = `
                <h3>${title}</h3>
                <canvas id="${qrId}" class="qr-canvas" width="256" height="256"></canvas>
                <p style="font-size: 0.9rem; word-break: break-all;">${url}</p>
                <div id="status-${qrId}">â³ ç”Ÿæˆä¸­...</div>
            `;
            container.appendChild(qrDiv);
            
            const canvas = document.getElementById(qrId);
            const statusDiv = document.getElementById(`status-${qrId}`);
            
            testStats.total++;
            updateStats();
            
            try {
                console.log(`ğŸ¯ å¼€å§‹ç”ŸæˆäºŒç»´ç : ${title}`);
                const startTime = Date.now();
                
                await QRCode.toCanvas(canvas, url, {
                    width: 256,
                    margin: 2,
                    color: {
                        dark: '#8B5CF6',
                        light: '#FFFFFF'
                    }
                });
                
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                testStats.success++;
                statusDiv.innerHTML = `<div class="success">âœ… ç”ŸæˆæˆåŠŸ (${duration}ms)</div>`;
                console.log(`âœ… ${title} ç”ŸæˆæˆåŠŸï¼Œè€—æ—¶: ${duration}ms`);
                
            } catch (error) {
                testStats.fail++;
                statusDiv.innerHTML = `<div class="error">âŒ ç”Ÿæˆå¤±è´¥: ${error.message}</div>`;
                console.error(`âŒ ${title} ç”Ÿæˆå¤±è´¥:`, error);
            }
            
            updateStats();
        }

        async function runQuickTest() {
            clearResults();
            const testUrl = `${window.location.origin}/view.html?id=test-${Date.now()}`;
            await generateQR(testUrl, 'å¿«é€Ÿæµ‹è¯•');
        }

        async function runStressTest() {
            clearResults();
            console.log('ğŸƒ å¼€å§‹å‹åŠ›æµ‹è¯• (5æ¬¡)');
            
            for (let i = 1; i <= 5; i++) {
                const testUrl = `${window.location.origin}/view.html?id=stress-test-${i}-${Date.now()}`;
                await generateQR(testUrl, `å‹åŠ›æµ‹è¯• ${i}/5`);
                
                // çŸ­æš‚å»¶è¿Ÿé¿å…å¹¶å‘é—®é¢˜
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            console.log('ğŸ å‹åŠ›æµ‹è¯•å®Œæˆ');
        }

        async function runAllTests() {
            clearResults();
            console.log('ğŸ”„ å¼€å§‹å…¨é¢æµ‹è¯•');
            
            const tests = [
                { url: `${window.location.origin}/view.html?id=test-basic`, title: 'åŸºç¡€æµ‹è¯•' },
                { url: `${window.location.origin}/view.html?id=test-long-id-${Date.now()}-with-more-content`, title: 'é•¿IDæµ‹è¯•' },
                { url: `${window.location.origin}/view.html?id=æµ‹è¯•ä¸­æ–‡-${Date.now()}`, title: 'ä¸­æ–‡æµ‹è¯•' },
                { url: `${window.location.origin}/view.html?id=test&param=value&time=${Date.now()}`, title: 'å‚æ•°æµ‹è¯•' },
                { url: `https://example.com/test`, title: 'å¤–éƒ¨URLæµ‹è¯•' }
            ];
            
            for (const test of tests) {
                await generateQR(test.url, test.title);
                await new Promise(resolve => setTimeout(resolve, 800));
            }
            
            console.log('âœ¨ å…¨é¢æµ‹è¯•å®Œæˆ');
        }

        async function testCustomUrl() {
            const url = document.getElementById('custom-url').value.trim();
            if (!url) {
                alert('è¯·è¾“å…¥è¦æµ‹è¯•çš„URL');
                return;
            }
            
            await generateQR(url, 'è‡ªå®šä¹‰URL');
        }

        async function testLongUrl() {
            const longParams = Array.from({length: 10}, (_, i) => `param${i}=value${i}`).join('&');
            const longUrl = `${window.location.origin}/view.html?id=long-test-${Date.now()}&${longParams}&description=è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿å¾ˆé•¿çš„æµ‹è¯•URLç”¨æ¥éªŒè¯äºŒç»´ç ç”ŸæˆåŠŸèƒ½çš„ç¨³å®šæ€§`;
            
            await generateQR(longUrl, 'é•¿URLæµ‹è¯•');
        }

        async function testSpecialChars() {
            const specialUrl = `${window.location.origin}/view.html?id=special-æµ‹è¯•-${Date.now()}&name=ç‰¹æ®Šå­—ç¬¦!@#$%^&*()`;
            await generateQR(specialUrl, 'ç‰¹æ®Šå­—ç¬¦æµ‹è¯•');
        }

        function clearResults() {
            document.getElementById('qr-container').innerHTML = '';
            testStats = { total: 0, success: 0, fail: 0 };
            updateStats();
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = () => {
            document.getElementById('custom-url').value = `${window.location.origin}/view.html?id=custom-test-${Date.now()}`;
            updateStats();
            console.log('ğŸš€ äºŒç»´ç æµ‹è¯•å·¥å…·å·²å¯åŠ¨');
        };
    </script>
</body>
</html>
