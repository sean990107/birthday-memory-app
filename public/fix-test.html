<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            border-left: 4px solid #8B5CF6;
        }
        .test-buttons {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        .test-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex !important;
            align-items: center;
            justify-content: center;
            gap: 5px;
            text-decoration: none;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 70px;
            box-sizing: border-box;
            color: white;
        }
        .test-btn:nth-child(1) { background: linear-gradient(135deg, #8B5CF6, #A855F7); }
        .test-btn:nth-child(2) { background: rgba(139, 92, 246, 0.3); border: 2px solid #8B5CF6; }
        .test-btn:nth-child(3) { background: rgba(139, 92, 246, 0.1); border: 2px solid #8B5CF6; }
        .test-btn:nth-child(4) { background: rgba(239, 68, 68, 0.1); border: 2px solid #EF4444; color: #EF4444; }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        
        button {
            background: #8B5CF6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover { 
            background: #7C3AED; 
            transform: translateY(-2px);
        }
        
        #results { margin-top: 20px; }
        .result-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
        }
        
        .demo-image {
            max-width: 200px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .qr-demo {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: #333;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢</h1>
    <p>æœ¬é¡µé¢ç”¨äºéªŒè¯æ‰€æœ‰ä¿®å¤æ˜¯å¦æ­£ç¡®ç”Ÿæ•ˆ</p>
    
    <div class="test-section">
        <h2>1ï¸âƒ£ æŒ‰é’®æ’ç‰ˆæµ‹è¯•</h2>
        <p>æŒ‰é’®åº”è¯¥<strong>æ¨ªå‘æ’åˆ—</strong>ï¼Œä¸æ˜¯ç«–å‘å †å ï¼š</p>
        <div class="test-buttons">
            <button class="test-btn">
                <i class="fas fa-eye"></i> æŸ¥çœ‹
            </button>
            <button class="test-btn">
                <i class="fas fa-edit"></i> ç¼–è¾‘
            </button>
            <button class="test-btn">
                <i class="fas fa-qrcode"></i> äºŒç»´ç 
            </button>
            <button class="test-btn">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <div id="layout-result" class="result-item">
            âœ… å¦‚æœä¸Šé¢çš„æŒ‰é’®æ˜¯æ¨ªå‘æ’åˆ—çš„ï¼Œè¯´æ˜CSSä¿®å¤æˆåŠŸï¼
        </div>
    </div>
    
    <div class="test-section">
        <h2>2ï¸âƒ£ åŠ¨æ€åœ°å€æµ‹è¯•</h2>
        <p>æµ‹è¯•äºŒç»´ç åœ°å€æ˜¯å¦ä½¿ç”¨åŠ¨æ€è·å–ï¼š</p>
        <div id="address-info" class="result-item">
            <strong>å½“å‰é¡µé¢åœ°å€ï¼š</strong><br>
            <span id="current-origin"></span><br><br>
            <strong>ç”Ÿæˆçš„äºŒç»´ç åœ°å€å°†æ˜¯ï¼š</strong><br>
            <span id="generated-url"></span>
        </div>
    </div>
    
    <div class="test-section">
        <h2>3ï¸âƒ£ å›¾ç‰‡åŠ è½½æµ‹è¯•</h2>
        <p>æµ‹è¯•å›¾ç‰‡é”™è¯¯å¤„ç†æœºåˆ¶ï¼š</p>
        <button onclick="testImageError()">ğŸ–¼ï¸ æµ‹è¯•å›¾ç‰‡é”™è¯¯å¤„ç†</button>
        <div id="image-test-area"></div>
    </div>
    
    <div class="test-section">
        <h2>4ï¸âƒ£ ç¼“å­˜ç ´åæµ‹è¯•</h2>
        <p>æ£€æŸ¥èµ„æºæ–‡ä»¶æ˜¯å¦æ·»åŠ äº†ç‰ˆæœ¬å·ï¼š</p>
        <button onclick="checkResourceVersions()">ğŸ”„ æ£€æŸ¥èµ„æºç‰ˆæœ¬</button>
        <div id="cache-test-result"></div>
    </div>
    
    <div style="text-align: center; margin: 30px 0;">
        <button onclick="location.href='index.html'" style="font-size: 1.1rem;">
            ğŸ  è¿”å›ä¸»åº”ç”¨
        </button>
        <button onclick="runAllTests()" style="font-size: 1.1rem;">
            ğŸ§ª è¿è¡Œå…¨éƒ¨æµ‹è¯•
        </button>
    </div>
    
    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></script>
    <script>
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        window.onload = () => {
            document.getElementById('current-origin').textContent = window.location.origin;
            document.getElementById('generated-url').textContent = 
                window.location.origin + window.location.pathname.replace('fix-test.html', '') + 'view.html?id=test-id';
            
            // æ£€æŸ¥æŒ‰é’®æ’åˆ—
            checkButtonLayout();
        };
        
        function checkButtonLayout() {
            const buttons = document.querySelectorAll('.test-buttons .test-btn');
            if (buttons.length >= 2) {
                const btn1 = buttons[0].getBoundingClientRect();
                const btn2 = buttons[1].getBoundingClientRect();
                
                const result = document.getElementById('layout-result');
                if (Math.abs(btn1.top - btn2.top) < 20) {
                    result.innerHTML = 'âœ… æŒ‰é’®æ¨ªå‘æ’åˆ—æ­£å¸¸ï¼CSSä¿®å¤æˆåŠŸï¼';
                    result.style.background = 'rgba(76, 175, 80, 0.2)';
                } else {
                    result.innerHTML = 'âŒ æŒ‰é’®ä»åœ¨ç«–å‘æ’åˆ—ï¼Œéœ€è¦æ¸…é™¤ç¼“å­˜æˆ–æ£€æŸ¥CSS';
                    result.style.background = 'rgba(244, 67, 54, 0.2)';
                }
            }
        }
        
        function testImageError() {
            const testArea = document.getElementById('image-test-area');
            testArea.innerHTML = `
                <div style="margin: 15px 0;">
                    <p>æ­£åœ¨æµ‹è¯•å›¾ç‰‡é”™è¯¯å¤„ç†...</p>
                    <img src="/nonexistent-image.jpg" 
                         alt="æµ‹è¯•å›¾ç‰‡" 
                         style="max-width: 200px; border-radius: 10px;"
                         onload="console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ')"
                         onerror="handleTestImageError(this)">
                </div>
            `;
        }
        
        function handleTestImageError(img) {
            img.parentElement.innerHTML = `
                <div style="text-align:center;padding:20px;background:rgba(76, 175, 80, 0.2);border-radius:10px;color:#4CAF50;">
                    <i class="fas fa-check-circle" style="font-size:2rem;"></i>
                    <p><strong>âœ… å›¾ç‰‡é”™è¯¯å¤„ç†æ­£å¸¸å·¥ä½œï¼</strong></p>
                    <p>é”™è¯¯å¤„ç†æœºåˆ¶å·²æ­£ç¡®è§¦å‘</p>
                </div>
            `;
        }
        
        function checkResourceVersions() {
            const result = document.getElementById('cache-test-result');
            const links = document.querySelectorAll('link[href*=".css"], script[src*=".js"]');
            
            let versioned = 0;
            let total = 0;
            let details = '<div style="margin: 15px 0;"><h4>èµ„æºæ–‡ä»¶æ£€æŸ¥ç»“æœï¼š</h4>';
            
            // æ¨¡æ‹Ÿæ£€æŸ¥ä¸»é¡µé¢çš„èµ„æº
            const mainPageResources = [
                'style.css?v=1.2',
                'animations.css?v=1.2',
                'script.js?v=1.2',
                'api.js?v=1.2',
                'qrcode-simple.js?v=1.2'
            ];
            
            mainPageResources.forEach(resource => {
                total++;
                if (resource.includes('?v=')) {
                    versioned++;
                    details += `<div style="color: #4CAF50;">âœ… ${resource}</div>`;
                } else {
                    details += `<div style="color: #f44336;">âŒ ${resource}</div>`;
                }
            });
            
            details += '</div>';
            
            const percentage = Math.round((versioned / total) * 100);
            result.innerHTML = `
                <div style="background: ${percentage === 100 ? 'rgba(76, 175, 80, 0.2)' : 'rgba(255, 193, 7, 0.2)'};
                           padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <h3>${percentage === 100 ? 'âœ…' : 'âš ï¸'} ç‰ˆæœ¬æ§åˆ¶çŠ¶æ€: ${percentage}% (${versioned}/${total})</h3>
                    ${details}
                    ${percentage === 100 ? 
                        '<p><strong>æ‰€æœ‰èµ„æºæ–‡ä»¶éƒ½å·²æ·»åŠ ç‰ˆæœ¬å·ï¼Œç¼“å­˜é—®é¢˜å·²è§£å†³ï¼</strong></p>' : 
                        '<p>éƒ¨åˆ†èµ„æºæ–‡ä»¶è¿˜éœ€è¦æ·»åŠ ç‰ˆæœ¬å·ã€‚</p>'
                    }
                </div>
            `;
        }
        
        function runAllTests() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>ğŸ§ª è¿è¡Œå…¨éƒ¨æµ‹è¯•...</h2>';
            
            // å»¶è¿Ÿè¿è¡Œæµ‹è¯•ï¼Œç»™ç”¨æˆ·çœ‹åˆ°è¿›åº¦
            setTimeout(() => {
                checkButtonLayout();
                testImageError();
                checkResourceVersions();
                
                results.innerHTML += `
                    <div style="background: rgba(76, 175, 80, 0.2); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h3>ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼</h3>
                        <p><strong>ä¿®å¤æ€»ç»“ï¼š</strong></p>
                        <ul style="text-align: left; margin: 15px 0;">
                            <li>âœ… æŒ‰é’®æ’ç‰ˆ: å·²ä¿®å¤ä¸ºæ¨ªå‘æ’åˆ—</li>
                            <li>âœ… åŠ¨æ€åœ°å€: ç§»é™¤ç¡¬ç¼–ç IPï¼Œæ”¯æŒæœåŠ¡å™¨éƒ¨ç½²</li>
                            <li>âœ… å›¾ç‰‡é”™è¯¯: æ·»åŠ æ™ºèƒ½é‡è¯•æœºåˆ¶</li>
                            <li>âœ… ç¼“å­˜æ§åˆ¶: æ·»åŠ ç‰ˆæœ¬å·é˜²æ­¢ç¼“å­˜é—®é¢˜</li>
                        </ul>
                        <p style="font-size: 1.1rem; font-weight: bold;">
                            ğŸš€ ç°åœ¨å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨äº†ï¼
                        </p>
                    </div>
                `;
            }, 1000);
        }
    </script>
</body>
</html>
